/*! jQuery-Impromptu - v5.3.0 - 2014-11-16
* http://trentrichardson.com/Impromptu
* Copyright (c) 2014 Trent Richardson; Licensed MIT */
(function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)})(this,function(t){"use strict";var e=function(i,n){void 0!==n&&void 0!==n.classes&&"string"==typeof n.classes&&(n={box:n.classes}),e.options=t.extend({},e.defaults,n),e.currentPrefix=e.options.prefix,e.timeout&&clearTimeout(e.timeout),e.timeout=!1;var o=e.options,s=t(document.body),a=t(window),r='<div class="'+e.options.prefix+"box "+o.classes.box+'">';r+=o.useiframe&&t("object, applet").length>0?'<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+o.prefix+"fade "+o.classes.fade+'"></iframe>':'<div class="'+o.prefix+"fade "+o.classes.fade+'"></div>',r+='<div class="'+o.prefix+" "+o.classes.prompt+'">'+'<form action="javascript:false;" onsubmit="return false;" class="'+o.prefix+"form "+o.classes.form+'">'+'<div class="'+o.prefix+"close "+o.classes.close+'">'+o.closeText+"</div>"+'<div class="'+o.prefix+'states"></div>'+"</form>"+"</div>"+"</div>",e.jqib=t(r).appendTo(s),e.jqi=e.jqib.children("."+o.prefix),e.jqif=e.jqib.children("."+o.prefix+"fade"),i.constructor===String&&(i={state0:{title:o.title,html:i,buttons:o.buttons,position:o.position,focus:o.focus,defaultButton:o.defaultButton,submit:o.submit}}),e.options.states={};var u,f;for(u in i)f=t.extend({},e.defaults.state,{name:u},i[u]),e.addState(f.name,f),""===e.currentStateName&&(e.currentStateName=f.name);e.jqi.on("click","."+o.prefix+"buttons button",function(){var i=t(this),n=i.parents("."+o.prefix+"state"),s=e.options.states[n.data("jqi-name")],a=n.children("."+o.prefix+"message"),r=s.buttons[i.text()]||s.buttons[i.html()],u={};if(void 0===r)for(var f in s.buttons)(s.buttons[f].title===i.text()||s.buttons[f].title===i.html())&&(r=s.buttons[f].value);t.each(e.jqi.children("form").serializeArray(),function(t,e){void 0===u[e.name]?u[e.name]=e.value:typeof u[e.name]===Array||"object"==typeof u[e.name]?u[e.name].push(e.value):u[e.name]=[u[e.name],e.value]});var l=new t.Event("impromptu:submit");l.stateName=s.name,l.state=n,n.trigger(l,[r,a,u]),l.isDefaultPrevented()||e.close(!0,r,a,u)});var l=function(){if(o.persistent){var i=(""+o.top).indexOf("%")>=0?a.height()*(parseInt(o.top,10)/100):parseInt(o.top,10),n=parseInt(e.jqi.css("top").replace("px",""),10)-i;t("html,body").animate({scrollTop:n},"fast",function(){var t=0;e.jqib.addClass(o.prefix+"warning");var i=setInterval(function(){e.jqib.toggleClass(o.prefix+"warning"),t++>1&&(clearInterval(i),e.jqib.removeClass(o.prefix+"warning"))},100)})}else e.close(!0)},p=function(i){var n=window.event?event.keyCode:i.keyCode;if(27===n&&l(),13===n){var s=e.getCurrentState().find("."+o.prefix+"defaultbutton"),a=t(i.target);a.is("textarea,."+o.prefix+"button")===!1&&s.length>0&&(i.preventDefault(),s.click())}if(9===n){var r=t("input,select,textarea,button",e.getCurrentState()),u=!i.shiftKey&&i.target===r[r.length-1],f=i.shiftKey&&i.target===r[0];if(u||f)return setTimeout(function(){if(r){var t=r[f===!0?r.length-1:0];t&&t.focus()}},10),!1}};return e.position(),e.style(),e.jqif.click(l),a.resize({animate:!1},e.position),e.jqi.find("."+o.prefix+"close").click(e.close),e.jqib.on("keydown",p).on("impromptu:loaded",o.loaded).on("impromptu:close",o.close).on("impromptu:statechanging",o.statechanging).on("impromptu:statechanged",o.statechanged),e.jqif[o.show](o.overlayspeed),e.jqi[o.show](o.promptspeed,function(){var t=e.jqi.find("."+o.prefix+"states ."+o.prefix+"state").eq(0);e.goToState(t.data("jqi-name")),e.jqib.trigger("impromptu:loaded")}),o.timeout>0&&(e.timeout=setTimeout(function(){e.close(!0)},o.timeout)),e.jqib};e.defaults={prefix:"jqi",classes:{box:"",fade:"",prompt:"",form:"",close:"",title:"",message:"",buttons:"",button:"",defaultButton:""},title:"",closeText:"&times;",buttons:{Ok:!0},loaded:function(){},submit:function(){},close:function(){},statechanging:function(){},statechanged:function(){},opacity:.6,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:0,defaultButton:0,useiframe:!1,top:"15%",position:{container:null,x:null,y:null,arrow:null,width:null},persistent:!0,timeout:0,states:{},state:{name:null,title:"",html:"",buttons:{Ok:!0},focus:0,defaultButton:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(){return!0}}},e.currentPrefix=e.defaults.prefix,e.currentStateName="",e.setDefaults=function(i){e.defaults=t.extend({},e.defaults,i)},e.setStateDefaults=function(i){e.defaults.state=t.extend({},e.defaults.state,i)},e.position=function(i){var n=t.fx.off,o=e.getCurrentState(),s=e.options.states[o.data("jqi-name")],a=s?s.position:void 0,r=t(window),u=document.body.scrollHeight,f=t(window).height(),l=(t(document).height(),u>f?u:f),p=parseInt(r.scrollTop(),10)+((""+e.options.top).indexOf("%")>=0?f*(parseInt(e.options.top,10)/100):parseInt(e.options.top,10));if(void 0!==i&&i.data.animate===!1&&(t.fx.off=!0),e.jqib.css({position:"absolute",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),e.jqif.css({position:"fixed",height:l,width:"100%",top:0,left:0,right:0,bottom:0}),a&&a.container){var c=t(a.container).offset();t.isPlainObject(c)&&void 0!==c.top&&(e.jqi.css({position:"absolute"}),e.jqi.animate({top:c.top+a.y,left:c.left+a.x,marginLeft:0,width:void 0!==a.width?a.width:null}),p=c.top+a.y-((""+e.options.top).indexOf("%")>=0?f*(parseInt(e.options.top,10)/100):parseInt(e.options.top,10)),t("html,body").animate({scrollTop:p},"slow","swing",function(){}))}else a&&a.width?(e.jqi.css({position:"absolute",left:"50%"}),e.jqi.animate({top:a.y||p,left:a.x||"50%",marginLeft:-1*(a.width/2),width:a.width})):e.jqi.css({position:"absolute",top:p,left:"50%",marginLeft:-1*(e.jqi.outerWidth(!1)/2)});void 0!==i&&i.data.animate===!1&&(t.fx.off=n)},e.style=function(){e.jqif.css({zIndex:e.options.zIndex,display:"none",opacity:e.options.opacity}),e.jqi.css({zIndex:e.options.zIndex+1,display:"none"}),e.jqib.css({zIndex:e.options.zIndex})},e.get=function(){return t("."+e.currentPrefix)},e.addState=function(i,n,o){var s,a,r,u,f,l="",p=null,c="",d="",m=e.options,x=t("."+e.currentPrefix+"states"),v=[],g=0;if(n=t.extend({},e.defaults.state,{name:i},n),null!==n.position.arrow&&(c='<div class="'+m.prefix+"arrow "+m.prefix+"arrow"+n.position.arrow+'"></div>'),n.title&&""!==n.title&&(d='<div class="lead '+m.prefix+"title "+m.classes.title+'">'+n.title+"</div>"),s=n.html,"function"==typeof n.html&&(s="Error: html function must return text"),l+='<div id="'+m.prefix+"state_"+i+'" class="'+m.prefix+'state" data-jqi-name="'+i+'" style="display:none;">'+c+d+'<div class="'+m.prefix+"message "+m.classes.message+'">'+s+"</div>"+'<div class="'+m.prefix+"buttons "+m.classes.buttons+'"'+(t.isEmptyObject(n.buttons)?'style="display:none;"':"")+">",t.isArray(n.buttons))v=n.buttons;else if(t.isPlainObject(n.buttons))for(r in n.buttons)n.buttons.hasOwnProperty(r)&&v.push({title:r,value:n.buttons[r]});for(g=0,f=v.length;f>g;g++)u=v[g],a=n.focus===g||isNaN(n.focus)&&n.defaultButton===g?e.currentPrefix+"defaultbutton "+m.classes.defaultButton:"",l+='<button class="'+m.classes.button+" "+e.currentPrefix+"button "+a,u.classes!==void 0&&(l+=" "+(t.isArray(u.classes)?u.classes.join(" "):u.classes)+" "),l+='" name="'+m.prefix+"_"+i+"_button"+u.title.replace(/[^a-z0-9]+/gi,"")+'" id="'+m.prefix+"_"+i+"_button"+u.title.replace(/[^a-z0-9]+/gi,"")+'" value="'+u.value+'">'+u.title+"</button>";return l+="</div></div>",p=t(l),p.on("impromptu:submit",n.submit),void 0!==o?x.find("#"+e.currentPrefix+"state_"+o).after(p):x.append(p),e.options.states[i]=n,p},e.removeState=function(t,i){var n=e.getState(t),o=function(){n.remove()};return 0===n.length?!1:("none"!==n.css("display")?void 0!==i&&e.getState(i).length>0?e.goToState(i,!1,o):n.next().length>0?e.nextState(o):n.prev().length>0?e.prevState(o):e.close():n.slideUp("slow",o),!0)},e.getState=function(i){return t("#"+e.currentPrefix+"state_"+i)},e.getStateContent=function(t){return e.getState(t)},e.getCurrentState=function(){return e.getState(e.getCurrentStateName())},e.getCurrentStateName=function(){return e.currentStateName},e.goToState=function(i,n,o){var s=(e.get(),e.options),a=e.getState(i),r=s.states[a.data("jqi-name")],u=new t.Event("impromptu:statechanging"),f=e.options;if(void 0!==r){if("function"==typeof r.html){var l=r.html;a.find("."+f.prefix+"message ").html(l())}"function"==typeof n&&(o=n,n=!1),e.jqib.trigger(u,[e.getCurrentStateName(),i]),!u.isDefaultPrevented()&&a.length>0&&(e.jqi.find("."+e.currentPrefix+"parentstate").removeClass(e.currentPrefix+"parentstate"),n?(e.jqi.find("."+e.currentPrefix+"substate").not(a).slideUp(s.promptspeed).removeClass("."+e.currentPrefix+"substate").find("."+e.currentPrefix+"arrow").hide(),e.jqi.find("."+e.currentPrefix+"state:visible").addClass(e.currentPrefix+"parentstate"),a.addClass(e.currentPrefix+"substate")):e.jqi.find("."+e.currentPrefix+"state").not(a).slideUp(s.promptspeed).find("."+e.currentPrefix+"arrow").hide(),e.currentStateName=r.name,a.slideDown(s.promptspeed,function(){var n=t(this);"string"==typeof r.focus?n.find(r.focus).eq(0).focus():n.find("."+e.currentPrefix+"defaultbutton").focus(),n.find("."+e.currentPrefix+"arrow").show(s.promptspeed),"function"==typeof o&&e.jqib.on("impromptu:statechanged",o),e.jqib.trigger("impromptu:statechanged",[i]),"function"==typeof o&&e.jqib.off("impromptu:statechanged",o)}),n||e.position())}return a},e.nextState=function(i){var n=t("#"+e.currentPrefix+"state_"+e.getCurrentStateName()).next();return n.length>0&&e.goToState(n.attr("id").replace(e.currentPrefix+"state_",""),i),n},e.prevState=function(i){var n=t("#"+e.currentPrefix+"state_"+e.getCurrentStateName()).prev();return n.length>0&&e.goToState(n.attr("id").replace(e.currentPrefix+"state_",""),i),n},e.close=function(i,n,o,s){e.timeout&&(clearTimeout(e.timeout),e.timeout=!1),e.jqib&&e.jqib.fadeOut("fast",function(){e.jqib.trigger("impromptu:close",[n,o,s]),e.jqib.remove(),t(window).off("resize",e.position)}),e.currentStateName=""},t.fn.prompt=function(i){void 0===i&&(i={}),void 0===i.withDataAndEvents&&(i.withDataAndEvents=!1),e(t(this).clone(i.withDataAndEvents).html(),i)},t.prompt=e,window.Impromptu=e});